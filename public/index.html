<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Whitelist Dashboard</title>
  <style>
    body { font-family: Arial, Helvetica, sans-serif; max-width: 900px; margin: 28px auto; padding: 10px; background:#f7f8fa; color:#222; }
    h1 { margin-bottom: 6px; }
    .card { background:white; padding:16px; border-radius:8px; box-shadow: 0 6px 18px rgba(0,0,0,0.06); margin-bottom: 14px; }
    .row { display:flex; gap:8px; align-items:center; margin-top:8px; }
    input[type=text], input[type=password] { padding:8px; border-radius:6px; border:1px solid #ddd; min-width: 200px; }
    button { padding:8px 12px; border-radius:6px; border: none; cursor:pointer; background:#2563eb; color:white; }
    .danger { background:#ef4444; }
    ul { list-style:none; padding:0; margin:0; }
    li { display:flex; justify-content:space-between; padding:8px 6px; border-bottom:1px solid #f0f0f0; align-items:center; }
    .small { font-size:13px; color:#555; }
    .hint { font-size:13px; color:#666; margin-top:8px; }
  </style>
</head>
<body>
  <h1>Whitelist Manager</h1>
  <div class="card">
    <div class="small">Server: <span id="serverUrl"></span></div>
    <div class="row">
      <input id="password" type="password" placeholder="Admin password (saved locally)">
      <button id="loginBtn">Set Password</button>
      <button id="refreshBtn">Refresh List</button>
    </div>
    <div class="hint">Password stored in your browser's localStorage only. For true security set ADMIN_PASSWORD env var on your host.</div>
  </div>

  <div class="card">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <strong>Current Whitelist</strong>
      <span class="small">Count: <span id="count">0</span></span>
    </div>

    <ul id="list"></ul>

    <div class="row" style="margin-top:12px;">
      <input id="nameInput" type="text" placeholder="Player name (case-sensitive)">
      <button onclick="addName()">Add</button>
      <button class="danger" onclick="removeName()">Remove</button>
    </div>
  </div>

  <script>
    const API_BASE = ""; // same origin (served by backend)
    document.getElementById("serverUrl").textContent = location.origin;

    // load saved password from localStorage
    const saved = localStorage.getItem("whitelist_password");
    if (saved) document.getElementById("password").value = saved;

    document.getElementById("loginBtn").addEventListener("click", () => {
      const pw = document.getElementById("password").value;
      localStorage.setItem("whitelist_password", pw);
      alert("Password saved locally (used for add/remove).");
    });

    document.getElementById("refreshBtn").addEventListener("click", loadList);

    async function loadList() {
      try {
        const res = await fetch(API_BASE + "/whitelist");
        const data = await res.json();
        const listEl = document.getElementById("list");
        document.getElementById("count").textContent = data.length;
        listEl.innerHTML = data.map(p => {
          return `<li><span>${p}</span><button onclick="quickRemove('${encodeURIComponent(p)}')">Remove</button></li>`;
        }).join("");
      } catch (err) {
        alert("Failed to load whitelist: " + err);
      }
    }

    async function addName() {
      const name = document.getElementById("nameInput").value.trim();
      const password = localStorage.getItem("whitelist_password") || document.getElementById("password").value;
      if (!name) return alert("Enter a name.");
      try {
        const res = await fetch(API_BASE + "/whitelist/add", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name, password })
        });
        const json = await res.json();
        if (res.status !== 200) return alert("Error: " + (json.error || JSON.stringify(json)));
        document.getElementById("nameInput").value = "";
        loadList();
      } catch (err) {
        alert("Failed to add: " + err);
      }
    }

    async function removeName() {
      const name = document.getElementById("nameInput").value.trim();
      const password = localStorage.getItem("whitelist_password") || document.getElementById("password").value;
      if (!name) return alert("Enter a name to remove.");
      try {
        const res = await fetch(API_BASE + "/whitelist/remove", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name, password })
        });
        const json = await res.json();
        if (res.status !== 200) return alert("Error: " + (json.error || JSON.stringify(json)));
        document.getElementById("nameInput").value = "";
        loadList();
      } catch (err) {
        alert("Failed to remove: " + err);
      }
    }

    // quick remove from list UI buttons
    async function quickRemove(encodedName) {
      const name = decodeURIComponent(encodedName);
      const password = localStorage.getItem("whitelist_password") || document.getElementById("password").value;
      if (!confirm("Remove " + name + " from whitelist?")) return;
      try {
        const res = await fetch(API_BASE + "/whitelist/remove", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name, password })
        });
        const json = await res.json();
        if (res.status !== 200) return alert("Error: " + (json.error || JSON.stringify(json)));
        loadList();
      } catch (err) {
        alert("Failed to remove: " + err);
      }
    }

    // initial load
    loadList();
  </script>
</body>
</html>